# 注册客户 - 宠物档案管理 + 服务与用品查询接口文档

## 一、项目概述

本项目是一个基于Spring Boot 3.1.2和MyBatis-Plus的宠物服务管理系统后端，主要实现了注册客户的宠物档案管理、服务查询和用品查询功能。系统采用3NF数据库设计，支持RESTful API风格，并集成了Knife4j进行接口文档生成。

## 二、技术栈

- **框架**: Spring Boot 3.1.2
- **ORM**: MyBatis-Plus 3.5.3.1
- **数据库**: MySQL 8.0
- **JDK**: 17
- **API文档**: Knife4j 4.4.0
- **验证框架**: Hibernate Validator (JSR-380)

## 三、数据库设计

### 3NF设计原则
- 每个表包含单一主题
- 所有非主属性完全依赖于主键
- 所有非主属性不传递依赖于主键

### 核心表结构

1. **customer** - 客户表
   - CustomerID (主键)
   - Name, Phone, Email, Address

2. **pet** - 宠物表
   - PetID (主键)
   - CustomerID (外键)
   - PetName, PetType, Breed, BirthDate, Gender, Weight, Color, PhotoPath

3. **appointment** - 预约表
   - ApptID (主键)
   - PetID (外键), EmpID (外键), ApptTime, ApptStatus

4. **service** - 服务表
   - Beauty, Medical, Foster等子表

5. **store** - 门店表
   - StoreID (主键)
   - StoreName, City, Address, Phone

6. **product** - 用品表
   - ProductID (主键)
   - ProductName, Type, Price, Stock, StoreID (外键)

## 四、API接口设计

### 1. 宠物档案管理

#### 1.1 创建宠物档案
- **路径**: `/api/pet`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "customerId": 1,
    "petName": "旺旺",
    "petType": "狗",
    "breed": "金毛",
    "birthDate": "2020-05-15",
    "gender": "公",
    "weight": 25.5,
    "color": "金黄色",
    "photoPath": "/upload/pets/wangwang.jpg"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "petId": 1
    }
  }
  ```

#### 1.2 查询宠物档案
- **路径**: `/api/pet/{petId}`
- **方法**: `GET`
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "petId": 1,
      "customerId": 1,
      "petName": "旺旺",
      "petType": "狗",
      "breed": "金毛",
      "birthDate": "2020-05-15",
      "gender": "公",
      "weight": 25.5,
      "color": "金黄色",
      "photoPath": "/upload/pets/******.jpg"
    }
  }
  ```

#### 1.3 更新宠物档案
- **路径**: `/api/pet/{petId}`
- **方法**: `PUT`
- **请求体**:
  ```json
  {
    "weight": 26.0
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": 1
  }
  ```

#### 1.4 查询宠物服务记录
- **路径**: `/api/pet/{petId}/service-records`
- **方法**: `GET`
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": [
      {
        "appointmentId": 1,
        "serviceDate": "2023-06-15",
        "serviceTime": "14:30:00",
        "status": "已完成",
        "serviceType": "美容",
        "serviceName": "全身清洁",
        "price": 80.0
      },
      {
        "appointmentId": 2,
        "serviceDate": "2023-07-20",
        "serviceTime": "10:00:00",
        "status": "已完成",
        "serviceType": "医疗",
        "serviceName": "疫苗接种",
        "price": 120.0
      }
    ]
  }
  ```

### 2. 服务查询

#### 2.1 美容服务查询
- **路径**: `/api/beauty`
- **方法**: `GET`
- **参数**:
  - `pageNum`: 页码 (默认1)
  - `pageSize`: 每页大小 (默认10)
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "total": 5,
      "rows": [
        {
          "beautyId": 1,
          "beautyName": "全身清洁",
          "price": 80.0,
          "duration": 60
        },
        {
          "beautyId": 2,
          "beautyName": "造型修剪",
          "price": 150.0,
          "duration": 120
        }
      ]
    }
  }
  ```

#### 2.2 医疗服务查询
- **路径**: `/api/medical`
- **方法**: `GET`
- **参数**:
  - `pageNum`: 页码 (默认1)
  - `pageSize`: 每页大小 (默认10)
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "total": 8,
      "rows": [
        {
          "medicalId": 1,
          "medicalName": "疫苗接种",
          "price": 120.0,
          "description": "狂犬疫苗接种"
        }
      ]
    }
  }
  ```

#### 2.3 寄养服务查询
- **路径**: `/api/boarding`
- **方法**: `GET`
- **参数**:
  - `pageNum`: 页码 (默认1)
  - `pageSize`: 每页大小 (默认10)
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "total": 3,
      "rows": [
        {
          "fosterId": 1,
          "fosterName": "标准寄养",
          "price": 50.0,
          "roomType": "标准间"
        }
      ]
    }
  }
  ```

### 3. 门店与用品查询

#### 3.1 门店查询
- **路径**: `/api/store`
- **方法**: `GET`
- **参数**:
  - `city`: 城市 (可选)
  - `pageNum`: 页码 (默认1)
  - `pageSize`: 每页大小 (默认10)
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "total": 2,
      "rows": [
        {
          "storeId": 1,
          "storeName": "宠物乐园总店",
          "city": "北京",
          "address": "朝阳区建国路88号",
          "phone": "010-12345678"
        }
      ]
    }
  }
  ```

#### 3.2 宠物用品查询
- **路径**: `/api/product`
- **方法**: `GET`
- **参数**:
  - `storeId`: 门店ID (可选)
  - `type`: 用品类型 (可选)
  - `pageNum`: 页码 (默认1)
  - `pageSize`: 每页大小 (默认10)
- **响应**:
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "total": 10,
      "rows": [
        {
          "productId": 1,
          "productName": "狗粮",
          "type": "食品",
          "price": 180.0,
          "stock": 100,
          "storeId": 1
        }
      ]
    }
  }
  ```

## 五、实现细节

### 1. 数据验证

系统使用JSR-380验证注解进行参数校验：

```java
@Data
public class PetDTO {
    @NotNull(message = "客户ID不能为空")
    private Integer customerId;
    
    @NotBlank(message = "宠物名称不能为空")
    @Size(max = 50, message = "宠物名称不能超过50个字符")
    private String petName;
    
    @NotNull(message = "宠物类型不能为空")
    private String petType;
    
    @DecimalMin(value = "0.1", message = "体重不能小于0.1kg")
    private Double weight;
}
```

### 2. 分页实现

采用统一的PageResultVO包装类：

```java
@Data
public class PageResultVO<T> {
    private Long total;
    private List<T> rows;
}
```

### 3. 数据脱敏

对宠物照片路径进行脱敏处理：

```java
@JsonSerialize(using = DesensitizeSerializer.class)
private String photoPath;
```

### 4. Mapper XML设计

使用MyBatis-Plus的XML映射文件，实现复杂查询：

```xml
<select id="selectPetServiceRecords" parameterType="java.lang.Integer" resultType="java.util.Map">
    SELECT
        appt.ApptID AS appointmentId,
        appt.ApptTime AS serviceDate,
        appt.ApptTime AS serviceTime,
        appt.ApptStatus AS status,
        '美容' AS serviceType,
        b.BeautyName AS serviceName,
        b.Price AS price
    FROM
        appointment appt
    LEFT JOIN apptBeauty ab ON appt.ApptID = ab.ApptID
    LEFT JOIN beauty b ON ab.BeautyID = b.BeautyID
    WHERE
        appt.PetID = #{petId}
    
    UNION ALL
    
    SELECT
        appt.ApptID AS appointmentId,
        mr.MedicalTime AS serviceDate,
        mr.MedicalTime AS serviceTime,
        appt.ApptStatus AS status,
        '医疗' AS serviceType,
        '医疗服务' AS serviceName,
        mr.MedicalFee AS price
    FROM
        appointment appt
    LEFT JOIN apptMedical am ON appt.ApptID = am.ApptID
    LEFT JOIN medicalRecord mr ON am.MedicalID = mr.MedicalID
    WHERE
        appt.PetID = #{petId}
</select>
```

## 六、测试步骤

### 1. 环境准备

1. 安装JDK 17
2. 安装MySQL 8.0
3. 导入数据库脚本：`docs/建表语句.sql`
4. 配置数据库连接：`application.yml`

### 2. 启动项目

```bash
mvn spring-boot:run
```

### 3. 接口测试

#### 3.1 使用Knife4j

访问：http://localhost:8080/doc.html

#### 3.2 使用Postman

1. **创建宠物档案**
   - URL: `http://localhost:8080/api/pet`
   - Method: POST
   - Body: JSON格式宠物信息

2. **查询宠物服务记录**
   - URL: `http://localhost:8080/api/pet/1/service-records`
   - Method: GET

3. **查询美容服务**
   - URL: `http://localhost:8080/api/beauty?pageNum=1&pageSize=5`
   - Method: GET

4. **查询门店**
   - URL: `http://localhost:8080/api/store?city=北京&pageNum=1&pageSize=10`
   - Method: GET

5. **查询宠物用品**
   - URL: `http://localhost:8080/api/product?type=食品&pageNum=1&pageSize=10`
   - Method: GET

### 4. 功能测试要点

1. **宠物档案管理**
   - 创建、查询、更新宠物信息
   - 查询宠物服务记录完整性

2. **服务查询**
   - 分页功能验证
   - 服务类型正确性

3. **门店与用品查询**
   - 按条件筛选功能
   - 分页参数有效性

## 七、部署说明

### 1. 打包项目

```bash
mvn clean package -DskipTests
```

### 2. 运行jar包

```bash
java -jar PetServiceManagement-1.0.0.jar
```

### 3. 配置文件修改

可通过外部application.yml覆盖默认配置：

```bash
java -jar PetServiceManagement-1.0.0.jar --spring.config.location=file:/path/to/application.yml
```

## 八、注意事项

1. 系统使用UTF-8编码，请确保数据库和应用配置一致
2. 所有API接口均需通过身份验证（本版本暂未实现，可根据需求添加）
3. 生产环境需配置HTTPS和更严格的安全措施
4. 定期备份数据库，确保数据安全

## 九、项目结构

```
├── src/main/java/cn/edu/xaut/
│   ├── controller        # 控制器层
│   ├── domain            # 领域模型
│   ├── mapper            # Mapper接口
│   ├── service           # 服务层
│   └── PetServiceManagementApplication.java
├── src/main/resources/
│   ├── mapper            # Mapper XML文件
│   └── application.yml   # 配置文件
└── docs/
    ├── 建表语句.sql          # 数据库脚本
    └── 接口文档.md          # 接口文档
```

## 十、联系信息

如有问题或建议，请联系项目开发团队。