# 注册客户账号和个人信息管理功能后端接口说明文档

## 1. 项目概述

宠物服务管理系统是一个为宠物主人和宠物服务机构提供服务的平台，本文档为该系统的后端部分，主要实现了注册客户账号和个人信息管理功能。

## 2. 技术栈

- Spring Boot 3.1.2：后端框架
- MyBatis：ORM框架
- MySQL：数据库
- Knife4j：API文档生成工具
- Lombok：代码简化工具
- Jakarta Bean Validation：参数校验

## 3. 核心功能

### 3.1 用户注册

**接口路径**：`/api/users/register`
**请求方法**：POST
**请求体**：
```json
{
  "account": "C123456",
  "phone": "13812345678",
  "password": "123456"
}
```
**响应示例**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 1,
    "account": "C123456",
    "name": null,
    "phone": "138****5678",
    "email": null,
    "registerTime": "2023-12-17T21:00:00"
  }
}
```

### 3.2 用户登录

**接口路径**：`/api/users/login`
**请求方法**：POST
**请求体**：
```json
{
  "account": "C123456",
  "password": "123456"
}
```
**响应示例**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 1,
    "account": "C123456",
    "name": null,
    "phone": "138****5678",
    "email": null,
    "lastLoginTime": "2023-12-17T21:30:00"
  }
}
```

### 3.3 密码重置

**接口路径**：`/api/users/reset-password`
**请求方法**：POST
**请求体**：
```json
{
  "phone": "13812345678",
  "password": "newpassword"
}
```
**响应示例**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 3.4 个人信息修改

**接口路径**：`/api/users/info`
**请求方法**：PUT
**请求参数**：userId
**请求体**：
```json
{
  "name": "张三",
  "gender": "男",
  "age": 25,
  "email": "zhangsan@example.com",
  "address": "北京市朝阳区"
}
```
**响应示例**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 1,
    "account": "C123456",
    "name": "张三",
    "gender": "男",
    "age": 25,
    "phone": "138****5678",
    "email": "z****@example.com",
    "address": "北京市朝阳区",
    "updateTime": "2023-12-17T21:45:00"
  }
}
```

### 3.5 个人信息查询

**接口路径**：`/api/users/info`
**请求方法**：GET
**请求参数**：userId
**响应示例**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 1,
    "account": "C123456",
    "name": "张三",
    "gender": "男",
    "age": 25,
    "phone": "138****5678",
    "email": "z****@example.com",
    "address": "北京市朝阳区",
    "registerTime": "2023-12-17T21:00:00",
    "lastLoginTime": "2023-12-17T21:30:00",
    "updateTime": "2023-12-17T21:45:00"
  }
}
```

## 4. 数据安全

### 4.1 密码加密

系统采用MD5+盐值的方式对密码进行加密存储，确保密码的安全性。

### 4.2 数据脱敏

- 手机号：仅显示前3位和后4位，中间用****代替（如：138****5678）
- 邮箱：仅显示首字符，中间用****代替（如：z****@example.com）

### 4.3 权限控制

用户只能访问和修改自己的信息，通过userId参数进行权限控制。

## 5. 统一响应格式

所有接口均采用统一的响应格式：

```json
{
  "code": 200, // 状态码：200表示成功，其他表示失败
  "message": "操作成功", // 响应消息
  "data": null // 响应数据
}
```


常见状态码：
- 200：操作成功
- 400：参数错误
- 401：未授权
- 500：业务错误

## 6. API文档访问

项目启动后，可以通过以下地址访问API文档：
`http://localhost:8080/doc.html`

## 7. 部署说明

### 7.1 环境要求

- JDK 17+
- Maven 3.6+
- MySQL 8.0+

### 7.2 数据库配置

修改`src/main/resources/application.yml`文件中的数据库配置：

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/pet_service_management?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf8&useSSL=false
    username: root
    password: 123456
```

### 7.3 启动项目

```bash
mvn spring-boot:run
```

## 8. 测试步骤

### 8.1 环境准备

1. 确保MySQL数据库已安装并启动
2. 创建数据库：`CREATE DATABASE pet_service_management;`
3. 执行数据库脚本创建表结构
4. 启动项目

### 8.2 接口测试

#### 8.2.1 用户注册测试

1. 打开Postman或其他API测试工具
2. 设置请求方法为POST
3. 输入URL：`http://localhost:8080/api/users/register`
4. 设置请求体为JSON格式，输入注册信息
5. 发送请求，查看响应结果

#### 8.2.2 用户登录测试

1. 打开Postman或其他API测试工具
2. 设置请求方法为POST
3. 输入URL：`http://localhost:8080/api/users/login`
4. 设置请求体为JSON格式，输入登录信息
5. 发送请求，查看响应结果

#### 8.2.3 密码重置测试

1. 打开Postman或其他API测试工具
2. 设置请求方法为POST
3. 输入URL：`http://localhost:8080/api/users/reset-password`
4. 设置请求体为JSON格式，输入手机号和新密码
5. 发送请求，查看响应结果

#### 8.2.4 个人信息修改测试

1. 打开Postman或其他API测试工具
2. 设置请求方法为PUT
3. 输入URL：`http://localhost:8080/api/users/info?userId=1`
4. 设置请求体为JSON格式，输入要修改的信息
5. 发送请求，查看响应结果

#### 8.2.5 个人信息查询测试

1. 打开Postman或其他API测试工具
2. 设置请求方法为GET
3. 输入URL：`http://localhost:8080/api/users/info?userId=1`
4. 发送请求，查看响应结果

## 9. 代码结构

```
├── controller/          # 控制器层
│   └── UserController.java
├── domain/              # 领域模型
│   ├── dto/            # 数据传输对象
│   │   └── user/       # 用户相关DTO
│   ├── entity/         # 实体类
│   │   └── user/       # 用户实体
│   └── vo/             # 视图对象
│       └── user/       # 用户视图对象
├── mapper/             # 数据访问层
│   └── UserMapper.java
├── service/            # 业务逻辑层
│   └── user/           # 用户服务
│       ├── UserService.java
│       └── impl/
│           └── UserServiceImpl.java
└── utils/              # 工具类
    └── CommonUtils.java
```

## 10. 联系方式

如有问题，请联系项目开发团队。

---

**文档版本**：v1.0
**更新时间**：2023-12-17
**编写人**：王鹤霖